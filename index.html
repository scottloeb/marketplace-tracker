<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Marketplace Tracker - Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .sync-section {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .sync-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .sync-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sync-btn.upload {
            background: #28a745;
            color: white;
        }

        .sync-btn.download {
            background: #007bff;
            color: white;
        }

        .sync-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .sync-code-section {
            display: none;
            margin-top: 15px;
        }

        .sync-code-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
            font-family: monospace;
        }

        .sync-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
        }

        .content {
            padding: 20px;
        }

        .add-listing-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            transition: transform 0.3s;
        }

        .add-listing-btn:hover {
            transform: translateY(-2px);
        }

        .listings-section h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .listing-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .listing-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .listing-price {
            color: #28a745;
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .listing-meta {
            color: #6c757d;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèçÔ∏è Smart Marketplace Tracker</h1>
            <p>Find, Track, Analyze, Win</p>
        </div>

        <!-- Sync Section -->
        <div class="sync-section">
            <div class="sync-buttons">
                <button class="sync-btn upload" onclick="uploadData()">üì§ Upload to Cloud</button>
                <button class="sync-btn download" onclick="showDownloadSection()">üì• Download from Cloud</button>
            </div>
            
            <div id="downloadSection" class="sync-code-section">
                <input type="text" id="syncCodeInput" class="sync-code-input" placeholder="Enter sync code (e.g., ABC123)" maxlength="6">
                <button class="sync-btn download" onclick="downloadData()" style="margin-top: 10px; width: 100%;">Download Data</button>
            </div>
            
            <div id="syncStatus" class="sync-status" style="display: none;"></div>
        </div>

        <div class="content">
            <button class="add-listing-btn" onclick="showModal()">
                ‚ûï Add New Listing
            </button>

            <div class="listings-section">
                <h3>
                    Your Listings
                    <span id="listingCount" style="background: #667eea; color: white; padding: 4px 8px; border-radius: 12px; font-size: 14px;">0</span>
                </h3>
                <div id="listingsContainer">
                    <p style="text-align: center; color: #6c757d; font-style: italic;">No listings yet. Add your first listing!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for adding listings -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <h3>‚ûï Add New Listing</h3>
            
            <div class="form-group">
                <label for="listingUrl">Marketplace URL</label>
                <input type="url" id="listingUrl" placeholder="https://facebook.com/marketplace/...">
            </div>
            
            <div class="form-group">
                <label for="listingTitle">Title</label>
                <input type="text" id="listingTitle" placeholder="2023 Honda CBR600RR">
            </div>
            
            <div class="form-group">
                <label for="listingPrice">Price</label>
                <input type="number" id="listingPrice" placeholder="8500">
            </div>
            
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="hideModal()">Cancel</button>
                <button class="btn btn-primary" onclick="addListing()">Add Listing</button>
            </div>
        </div>
    </div>

    <script>
        let listings = [];

        // Load existing data
        function loadData() {
            const saved = localStorage.getItem('smart-marketplace-listings');
            if (saved) {
                listings = JSON.parse(saved);
                displayListings();
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('smart-marketplace-listings', JSON.stringify(listings));
            displayListings();
        }

        // Display listings
        function displayListings() {
            const container = document.getElementById('listingsContainer');
            const count = document.getElementById('listingCount');
            
            count.textContent = listings.length;
            
            if (listings.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d; font-style: italic;">No listings yet. Add your first listing!</p>';
                return;
            }
            
            container.innerHTML = listings.map(listing => `
                <div class="listing-card">
                    <div class="listing-title">${listing.title}</div>
                    <div class="listing-price">$${listing.price?.toLocaleString() || 'No price'}</div>
                    <div class="listing-meta">
                        ${listing.source} ‚Ä¢ Added ${new Date(listing.addedDate).toLocaleDateString()}
                        ${listing.url ? ` ‚Ä¢ <a href="${listing.url}" target="_blank" style="color: #667eea;">View</a>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Modal functions
        function showModal() {
            document.getElementById('modal').style.display = 'block';
        }

        function hideModal() {
            document.getElementById('modal').style.display = 'none';
            // Clear form
            document.getElementById('listingUrl').value = '';
            document.getElementById('listingTitle').value = '';
            document.getElementById('listingPrice').value = '';
        }

        // Add new listing
        function addListing() {
            const url = document.getElementById('listingUrl').value;
            const title = document.getElementById('listingTitle').value;
            const price = parseFloat(document.getElementById('listingPrice').value);
            
            if (!title) {
                alert('Please enter a title');
                return;
            }
            
            const listing = {
                id: Date.now(),
                title: title,
                price: price || null,
                url: url || null,
                source: url ? getSourceFromUrl(url) : 'Manual Entry',
                status: 'pending',
                addedDate: new Date().toISOString(),
                mobileAdded: true
            };
            
            listings.push(listing);
            saveData();
            hideModal();
        }

        // Extract source from URL
        function getSourceFromUrl(url) {
            if (url.includes('facebook.com')) return 'Facebook Marketplace';
            if (url.includes('craigslist.org')) return 'Craigslist';
            if (url.includes('autotrader.com')) return 'AutoTrader';
            if (url.includes('cars.com')) return 'Cars.com';
            return 'Other';
        }

        // Sync functions
        async function uploadData() {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = 'üîÑ Uploading data to cloud...';
            statusDiv.style.background = '#fff3cd';
            statusDiv.style.color = '#856404';
            
            try {
                // Generate a simple 6-character sync code
                const syncCode = Math.random().toString(36).substring(2, 8).toUpperCase();
                
                // Prepare data for upload
                const syncData = {
                    code: syncCode,
                    timestamp: new Date().toISOString(),
                    listingCount: listings.length,
                    data: listings
                };
                
                // Use JSONBin.io as a simple cloud storage (you'll need an API key for production)
                // For demo purposes, we'll simulate the upload
                await simulateUpload(syncData);
                
                statusDiv.innerHTML = `‚úÖ Data uploaded! Share this code: <strong>${syncCode}</strong><br><small>Code expires in 24 hours</small>`;
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
                
                // Store the sync code for reference
                localStorage.setItem('lastSyncCode', syncCode);
                
            } catch (error) {
                statusDiv.innerHTML = `‚ùå Upload failed: ${error.message}`;
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
            }
        }

        function showDownloadSection() {
            const section = document.getElementById('downloadSection');
            section.style.display = section.style.display === 'none' ? 'block' : 'none';
        }

        async function downloadData() {
            const syncCode = document.getElementById('syncCodeInput').value.trim().toUpperCase();
            const statusDiv = document.getElementById('syncStatus');
            
            if (!syncCode) {
                alert('Please enter a sync code');
                return;
            }
            
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = 'üîÑ Downloading data from cloud...';
            statusDiv.style.background = '#fff3cd';
            statusDiv.style.color = '#856404';
            
            try {
                // Simulate download (in production, this would call the cloud service)
                const syncData = await simulateDownload(syncCode);
                
                if (!syncData) {
                    throw new Error('Sync code not found or expired');
                }
                
                // Merge downloaded data with existing data
                const downloadedListings = syncData.data || [];
                const mergedListings = mergeListings(listings, downloadedListings);
                
                listings = mergedListings;
                saveData();
                
                statusDiv.innerHTML = `‚úÖ Downloaded ${downloadedListings.length} listings! Total: ${listings.length}`;
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
                
                document.getElementById('downloadSection').style.display = 'none';
                
            } catch (error) {
                statusDiv.innerHTML = `‚ùå Download failed: ${error.message}`;
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
            }
        }

        // Simulate cloud upload (replace with real service in production)
        async function simulateUpload(syncData) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    // Store in sessionStorage to simulate cloud storage
                    sessionStorage.setItem(`sync_${syncData.code}`, JSON.stringify(syncData));
                    resolve(syncData);
                }, 1500);
            });
        }

        // Simulate cloud download (replace with real service in production)
        async function simulateDownload(syncCode) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    const stored = sessionStorage.getItem(`sync_${syncCode}`);
                    if (stored) {
                        resolve(JSON.parse(stored));
                    } else {
                        reject(new Error('Code not found'));
                    }
                }, 1000);
            });
        }

        // Merge listings to avoid duplicates
        function mergeListings(existing, downloaded) {
            const existingIds = new Set(existing.map(l => l.id));
            const newListings = downloaded.filter(l => !existingIds.has(l.id));
            return [...existing, ...newListings];
        }

        // Initialize app
        window.addEventListener('load', loadData);
    </script>
</body>
</html>
